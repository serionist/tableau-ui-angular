@for (node of $childrenDisplayOrder(); let i = $index; track i) {
  @if (!node.$parent() || node.$allParentsExpanded()) {
    <ng-container *ngTemplateOutlet="node.$template()!; context: templateParams" />
  }
}
